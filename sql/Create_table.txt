DROP TABLE menu CASCADE CONSTRAINTS;

DROP TABLE order_detail CASCADE CONSTRAINTS;

DROP TABLE review CASCADE CONSTRAINTS;

DROP TABLE user_info CASCADE CONSTRAINTS;

DROP TABLE user_order CASCADE CONSTRAINTS;

CREATE TABLE menu (
    menu_id NUMBER GENERATED BY DEFAULT AS IDENTITY (
        START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE
    ) NOT NULL,
    name VARCHAR2(30) NOT NULL,
    price INTEGER NOT NULL,
    category VARCHAR(20) NOT NULL,
    menu_desc VARCHAR2(100) NOT NULL,
    menu_path VARCHAR(500) NOT NULL
)
LOGGING;

ALTER TABLE menu ADD CONSTRAINT menu_pk PRIMARY KEY (menu_id);


CREATE TABLE order_detail (
    detail_id NUMBER GENERATED BY DEFAULT AS IDENTITY (
        START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE
    ) NOT NULL,
    menu_id INTEGER NOT NULL,
    order_id INTEGER NOT NULL,
    quantity INTEGER NOT NULL
)
LOGGING;

ALTER TABLE order_detail ADD CONSTRAINT order_detail_pk PRIMARY KEY (detail_id);


CREATE TABLE review (
    review_id NUMBER GENERATED BY DEFAULT AS IDENTITY (
        START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE
    ) NOT NULL,
    title VARCHAR2(50) NOT NULL,
    content VARCHAR2(500) NOT NULL,
    rating INTEGER NOT NULL,
    review_date DATE NOT NULL,
    menu_id INTEGER NOT NULL,
    detail_id INTEGER NOT NULL
)
LOGGING;

ALTER TABLE review ADD CONSTRAINT review_pk PRIMARY KEY (review_id);


CREATE TABLE user_info (
    user_id NUMBER GENERATED BY DEFAULT AS IDENTITY (
        START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE
    ) NOT NULL,
    phonenum INTEGER NOT NULL,
    join_date DATE NOT NULL,
    point INTEGER NOT NULL,
    status INTEGER DEFAULT 1 NOT NULL
)
LOGGING;

ALTER TABLE user_info ADD CONSTRAINT user_info_pk PRIMARY KEY (user_id);
ALTER TABLE user_info ADD CONSTRAINT user_info_pkv1 UNIQUE (phonenum);


CREATE TABLE user_order (
    order_id NUMBER GENERATED BY DEFAULT AS IDENTITY (
        START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE
    ) NOT NULL,
    order_date DATE NOT NULL,
    user_id INTEGER NOT NULL
)
LOGGING;

ALTER TABLE user_order ADD CONSTRAINT order_pk PRIMARY KEY (order_id);



ALTER TABLE order_detail
    ADD CONSTRAINT order_detail_menu_fk FOREIGN KEY ( menu_id )
        REFERENCES menu ( menu_id )
    NOT DEFERRABLE;

ALTER TABLE order_detail
    ADD CONSTRAINT order_detail_user_order_fk FOREIGN KEY ( order_id )
        REFERENCES user_order ( order_id )
    NOT DEFERRABLE;

ALTER TABLE user_order
    ADD CONSTRAINT order_user_info_fk FOREIGN KEY ( user_id )
        REFERENCES user_info ( user_id )
    NOT DEFERRABLE;

ALTER TABLE review
    ADD CONSTRAINT review_menu_fk FOREIGN KEY ( menu_id )
        REFERENCES menu ( menu_id )
    NOT DEFERRABLE;

ALTER TABLE review
    ADD CONSTRAINT review_order_detail_fk FOREIGN KEY ( detail_id )
        REFERENCES order_detail ( detail_id )
    NOT DEFERRABLE;

